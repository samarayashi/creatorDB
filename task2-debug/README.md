# Task 2 - JavaScript éåŒæ­¥ç¨‹å¼ç¢¼ Debug

## ğŸ¯ æ ¸å¿ƒå•é¡Œåˆ†æ

### ä¸»è¦ Bugï¼š`var` è®Šæ•¸ä½œç”¨åŸŸé™·é˜±
åŸå§‹ç¨‹å¼ç¢¼ä½¿ç”¨ `var i` åœ¨ for è¿´åœˆä¸­ï¼Œé€ æˆ**å‡½æ•¸ä½œç”¨åŸŸå…±äº«**å•é¡Œï¼š

**åŸ·è¡Œæ™‚åºï¼š**
1. **è¿´åœˆéšæ®µï¼ˆåŒæ­¥ï¼‰**ï¼š`i = 0, 1, 2` ä¾åºå‰µå»º 3 å€‹ Promiseï¼Œæ¯å€‹ç«‹å³é–‹å§‹ç¬¬ä¸€å€‹è«‹æ±‚ âœ…
2. **è¿´åœˆçµæŸ**ï¼š`i++` ä½¿ `i = 3`ï¼Œæ¢ä»¶ `3 < 3` ç‚º falseï¼Œè¿´åœˆçµæŸ
3. **éåŒæ­¥éšæ®µ**ï¼šç•¶ç¬¬ä¸€å€‹ `await` å®Œæˆï¼Œæº–å‚™ç¬¬äºŒå€‹è«‹æ±‚æ™‚ï¼Œ**æ‰€æœ‰ Promise å…±äº«çš„ `i` å·²ç¶“æ˜¯ 3**
4. **çµæœ**ï¼š`youtubeIds[3] = undefined`ï¼Œæ‰€æœ‰ `videosURL` éƒ½è®Šæˆ `undefined/videos`

**å¯¦éš›æ¸¬è©¦çµæœï¼š**
- âœ… `channelURL`: æ­£ç¢ºå–å¾—å„è‡ªçš„ YouTube ID  
- âŒ `videosURL`: å…¨éƒ¨è®Šæˆ `undefined/videos`

## ğŸš€ è§£æ±ºæ–¹æ¡ˆè¨­è¨ˆæ€è·¯

### æ ¸å¿ƒæ¶æ§‹é¸æ“‡ï¼š`map()` + `Promise.all()` + `try-catch`

**ç‚ºä»€éº¼é¸æ“‡ `map()` è€Œé `let`/`const`ï¼Ÿ**
é›–ç„¶ç†è«–ä¸Šå¯ç”¨ `let`/`const` è§£æ±ºä½œç”¨åŸŸå•é¡Œï¼Œä½†æˆ‘é¸æ“‡ `map()` çš„åŸå› ï¼š
- æ¯å€‹å›èª¿å‡½æ•¸éƒ½æœ‰ç¨ç«‹çš„åƒæ•¸ä½œç”¨åŸŸï¼Œå¾æ ¹æœ¬é¿å…é–‰åŒ…å•é¡Œ
- ç¬¦åˆç¾ä»£ JavaScript å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆç¿’æ…£
- ç¨‹å¼ç¢¼æ›´ç°¡æ½”ä¸”èªæ„æ¸…æ™°

### å®¹éŒ¯æ©Ÿåˆ¶è¨­è¨ˆè€ƒé‡

**è€ƒæ…®é `Promise.allSettled` vs `Promise.all` + `try-catch`ï¼š**
- `Promise.allSettled`ï¼šä¹Ÿæ˜¯å¯è¡Œçš„é¸æ“‡ï¼ŒåŒæ¨£èƒ½è™•ç†ç´°ç¯€çš„éŒ¯èª¤è³‡è¨Š
- **æœ€çµ‚é¸æ“‡ `Promise.all` + å€‹åˆ¥ `try-catch`**ï¼š
  - å°æ–¼é€™å€‹å ´æ™¯ï¼Œåªéœ€è¦çŸ¥é“å“ªå€‹ YouTube ID ç”¢ç”ŸéŒ¯èª¤å³å¯
  - éŒ¯èª¤çš„ ID é€šå¸¸ channel å’Œ videos é é¢éƒ½æœƒéŒ¯ï¼Œä¸éœ€è¦å€åˆ†å…·é«”æ˜¯å“ªå€‹è«‹æ±‚å¤±æ•—
  - é€™è£¡ä¸»è¦æ˜¯åŸºæ–¼éœ€æ±‚ç°¡æ½”æ€§çš„è€ƒé‡

### ä¸¦è¡ŒåŒ–å„ªåŒ– + å®¹éŒ¯è™•ç†
```typescript
const promises = youtubeIds.map(async (id): Promise<YoutubeDataResult> => {
  try {
    // æ¯å€‹ YouTube ID çš„å…©å€‹è«‹æ±‚ä¸¦è¡ŒåŸ·è¡Œ
    const [channelPage, videosPage] = await Promise.all([
      getPage(channelURL),
      getPage(videosURL),
    ]);
    return { id, channelPage, videosPage };
  } catch (error) {
    // å€‹åˆ¥éŒ¯èª¤è™•ç†ï¼Œé¿å…å–®é»å¤±æ•—å½±éŸ¿æ•´é«”
    return { id, error: error.message };
  }
});

return await Promise.all(promises); // æœ€å¤–å±¤ä¸æœƒå› ç‚ºå€‹åˆ¥å¤±æ•—è€Œå…¨éƒ¨å¤±æ•—
```
**é—œéµè¨­è¨ˆï¼š**
- å…§å±¤ä¸¦è¡ŒåŒ–ï¼šæ¯å€‹ ID çš„å…©å€‹è«‹æ±‚åŒæ™‚åŸ·è¡Œ
- å€‹åˆ¥ try-catchï¼šç¢ºä¿æœ€å¤–å±¤ `Promise.all` ä¸æœƒå› ç‚ºå–®å€‹ ID å¤±æ•—è€Œå…¨éƒ¨å¤±æ•—

### å¯¦éš›é‡åˆ°çš„å•é¡Œï¼š404 éŒ¯èª¤æª¢æ¸¬
åœ¨å¯¦éš›æ¸¬è©¦éç¨‹ä¸­ç™¼ç¾ï¼Œå³ä½¿ç„¡æ•ˆçš„ YouTube ID ä¹Ÿæœƒå›å‚³ HTTP 200ï¼Œä½†å…§å®¹ç‚º 404 é é¢ã€‚å› æ­¤è‡ªè¡ŒåŠ å…¥å…§å®¹é©—è­‰æ©Ÿåˆ¶ï¼š
```typescript
function isValidYoutubePage(content: string): boolean {
  return !content.includes('404 Not Found') && !content.includes('/error?src=404');
}
```

## ğŸ“Š åŸ·è¡Œèˆ‡æ¸¬è©¦

### åŸ·è¡Œç¤ºä¾‹
```bash
npm run demo:ori          # problematic code 
npm run task2:demo:new    # Fixed version
npm run task2:test        # Unit tests
```

### æ¸¬è©¦æ¶µè“‹ç¯„åœ
- **åŸºæœ¬åŠŸèƒ½**ï¼šæ­£å¸¸ YouTube ID è™•ç†
- **å®¹éŒ¯æ©Ÿåˆ¶**ï¼šéƒ¨åˆ†å¤±æ•—ä¸å½±éŸ¿å…¶ä»–è«‹æ±‚
- **é‚Šç•Œæ¢ä»¶**ï¼šç©ºé™£åˆ—ã€å…¨éƒ¨å¤±æ•—
- **404 æª¢æ¸¬**ï¼šç„¡æ•ˆ YouTube ID è­˜åˆ¥
- **ä¸¦è¡ŒåŒ–é©—è­‰**ï¼šç¢ºèª fetch å‘¼å«æ¬¡æ•¸å’Œé †åº

## ğŸ“ æª”æ¡ˆçµæ§‹
```
task2-debug/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ original.js       # åŸå§‹å•é¡Œç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ fixed.ts         # ä¿®æ­£ç‰ˆæœ¬ï¼ˆæ ¸å¿ƒå¯¦ç¾ï¼‰
â”‚   â””â”€â”€ example.ts       # åŸ·è¡Œç¤ºä¾‹ï¼ˆçœŸå¯¦ç¶²è·¯è«‹æ±‚ï¼‰
â””â”€â”€ tests/
    â””â”€â”€ debug.test.ts    # å®Œæ•´æ¸¬è©¦å¥—ä»¶
```
